<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Seed Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    text-align: center;
}

header {
    background: #2b8a3e;
    color: white;
    padding: 15px;
    font-size: 22px;
    font-weight: bold;
}

#camera {
    width: 90%;
    margin-top: 15px;
    border-radius: 12px;
    background: black;
}

button {
    padding: 12px 20px;
    background: #2b8a3e;
    color: white;
    border: none;
    border-radius: 8px;
    margin: 10px;
    font-size: 17px;
}

select {
    padding: 10px;
    font-size: 16px;
    border-radius: 6px;
}

#colorDot {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin: auto;
    border: 4px solid black;
    margin-top: 15px;
}

#resultBox {
    padding: 15px;
    margin-top: 15px;
    background: white;
    border-radius: 12px;
    width: 90%;
    margin-left: auto;
    margin-right: auto;
    font-size: 18px;
    box-shadow: 0px 0px 8px #ccc;
}

#barOuter {
    width: 90%;
    height: 22px;
    background: #ddd;
    border-radius: 12px;
    margin: 20px auto;
}

#barInner {
    width: 0%;
    height: 100%;
    background: #2b8a3e;
    border-radius: 12px;
    transition: width 1s ease-in-out;
}
</style>
</head>

<body>

<header id="title">Smart Seed Scanner</header>

<select id="language" onchange="changeLanguage()">
<option value="en">English</option>
<option value="ml">Malayalam</option>
<option value="hi">Hindi</option>
</select>

<br>

<select id="seedType">
<option>Paddy</option>
<option>Wheat</option>
<option>Ragi</option>
<option>Green Gram</option>
<option>Black Gram</option>
<option>Bengal Gram</option>
<option>Maize</option>
<option>Coconut</option>
<option>Groundnut</option>
<option>Sesame</option>
<option>Mustard</option>
<option>Sorghum</option>
</select>

<br><br>

<video id="camera" autoplay playsinline></video>

<button onclick="startCamera()">Start Camera</button>
<button onclick="scanColor()">Scan Now</button>

<div id="colorDot"></div>

<div id="resultBox">
<span id="moistureStatus">Status: ---</span><br>
<span id="germRate">Germination: --- %</span>
</div>

<div id="barOuter"><div id="barInner"></div></div>

<script>
let video = document.getElementById("camera");
let bar = document.getElementById("barInner");
let dot = document.getElementById("colorDot");

let lang = "en";

// üîä Male Voice Alerts
function speak(text) {
    let msg = new SpeechSynthesisUtterance(text);
    msg.lang = lang === "ml" ? "ml-IN" : lang === "hi" ? "hi-IN" : "en-IN";
    msg.pitch = 1;
    msg.rate = 1;
    msg.voice = speechSynthesis.getVoices().find(v => v.name.toLowerCase().includes("male")) || null;
    speechSynthesis.speak(msg);
}

// üîî Buzzer tone
function beep() {
    let ctx = new AudioContext();
    let osc = ctx.createOscillator();
    osc.frequency.value = 550;
    osc.connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime + 0.15);
}

// START REAR CAMERA
async function startCamera() {
    try {
        let stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: { exact: "environment" } }
        });
        video.srcObject = stream;
    } catch (e) {
        alert("Rear camera not found. Try allowing camera permissions.");
    }
}

// SCAN COLOR
function scanColor() {
    let canvas = document.createElement("canvas");
    let ctx = canvas.getContext("2d");

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    ctx.drawImage(video, 0, 0);

    let x = canvas.width / 2;
    let y = canvas.height / 2;
    let size = 20;

    let data = ctx.getImageData(x - size, y - size, size, size).data;

    let r = 0, g = 0, b = 0;
    for (let i = 0; i < data.length; i += 4) {
        r += data[i];
        g += data[i + 1];
        b += data[i + 2];
    }

    r /= (size * size);
    g /= (size * size);
    b /= (size * size);

    let color = `rgb(${r},${g},${b})`;
    dot.style.background = color;

    classify(r, g, b);
}

// CLASSIFY
function classify(r, g, b) {
    let status = "";
    let germ = 0;

    if (r > g && r > b) {
        status = translate("dry");
        germ = 20;
    } else if (g > r && g > b) {
        status = translate("ideal");
        germ = 90;
    } else {
        status = translate("wet");
        germ = 40;
    }

    document.getElementById("moistureStatus").innerText = status;
    document.getElementById("germRate").innerText = translate("germ") + germ + "%";

    bar.style.width = germ + "%";

    beep();
    setTimeout(() => speak(status), 300);
}

// LANGUAGE SYSTEM
function translate(key) {
    let words = {
        en: {
            dry: "Too Dry - Low germination",
            ideal: "Ideal Moisture",
            wet: "Too Wet - Fungus Risk",
            germ: "Germination: "
        },
        ml: {
            dry: "‡¥µ‡¥≥‡¥∞‡µÜ ‡¥µ‡¥∞‡¥£‡µç‡¥ü‡¥§‡µç - ‡¥ï‡µÅ‡¥±‡¥µ‡µç ‡¥Æ‡µÅ‡¥≥‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µΩ",
            ideal: "‡¥∂‡¥∞‡¥ø‡¥Ø‡¥æ‡¥Ø ‡¥à‡µº‡¥™‡µç‡¥™‡¥Ç",
            wet: "‡¥µ‡¥≥‡¥∞‡µÜ ‡¥à‡µº‡¥™‡µç‡¥™‡¥Ç - ‡¥´‡¥Ç‡¥ó‡¥∏‡µç ‡¥Ö‡¥™‡¥ï‡¥ü‡¥Ç",
            germ: "‡¥Æ‡µÅ‡¥≥‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µΩ: "
        },
        hi: {
            dry: "‡§¨‡§π‡•Å‡§§ ‡§∏‡•Ç‡§ñ‡§æ - ‡§ï‡§Æ ‡§Ö‡§Ç‡§ï‡•Å‡§∞‡§£",
            ideal: "‡§∏‡§π‡•Ä ‡§®‡§Æ‡•Ä ‡§∏‡•ç‡§§‡§∞",
            wet: "‡§¨‡§π‡•Å‡§§ ‡§ó‡•Ä‡§≤‡§æ - ‡§´‡§´‡•Ç‡§Ç‡§¶‡•Ä ‡§ï‡§æ ‡§ñ‡§§‡§∞‡§æ",
            germ: "‡§Ö‡§Ç‡§ï‡•Å‡§∞‡§£: "
        }
    };

    return words[lang][key];
}

function changeLanguage() {
    lang = document.getElementById("language").value;
}
</script>

</body>
</html>